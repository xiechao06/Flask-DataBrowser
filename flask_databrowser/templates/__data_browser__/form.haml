-extends "__data_browser__/layout.haml"
-import '__data_browser__/macro.html' as lib with context

-block body
  %div.container
    =lib.render_form(form, return_url, extra)

-block __data_browser__customized_head_block
  %script type="text/javascript"
    $(function(){
      grouper_info = {{ grouper_info|tojson|safe }};
      for (var grouper_name in grouper_info) {
        var grouper_e = $('[name="' + grouper_name + '"]');
        var input_e = $('[name="' + grouper_name.split(".")[0] + '"]');

        grouper_e.change((function (grouper_e, input_e) {
          return function(ui) {
            input_e.empty();
            $.each(grouper_info[grouper_e.attr("name")][grouper_e.val()], function (idx, entry) {
              input_e.append('<option value="' + entry.id + '">' + entry.text + "</option>");
            });
            input_e.select2()
          }
            })(grouper_e, input_e))
      }
      $(".fancybox").fancybox();
      -if request.args.get("preview") == 'True'
        $("input").attr("disabled", true);
        $("select").select2("disable").attr("disabled", true);
    });
  

